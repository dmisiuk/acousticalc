---
epic: 0
story: 0.3
title: "Video Recording & Demo System"
status: "Planning"
---

### Story

As a developer and user, I want an automated demo recording system that captures application functionality with visual input display, so that I can create compelling demonstrations and validate user interactions for every feature.

### Acceptance Criteria

1. Terminal recording system captures complete user sessions with audio (if enabled)
2. Input visualization shows keyboard/mouse interactions overlaid on terminal output
3. Recording system supports multiple output formats (GIF, MP4, WEBM)
4. Demo scenarios can be scripted and executed automatically
5. Recording system captures calculator TUI interactions including button clicks and keyboard input
6. Audio feedback is synchronized with visual interactions in recordings
7. Recording system works across all target platforms (Windows, macOS, Linux)
8. Generated demos are optimized for web embedding and GitHub display

### Dev Notes

This story creates the core demo recording capability that will be used by PR automation and manual demonstration generation.

**Previous Story Insights**:
- Story 0.1 establishes visual testing infrastructure
- Need to build upon screenshot capabilities for full recording
- Integration with TUI framework for interaction capture

**Technology Stack**:
- **Terminal Recording**: asciinema, ttyrec, or custom Go solution
- **Video Generation**: ffmpeg for video conversion
- **Input Visualization**: Custom overlay system
- **Audio Capture**: Integration with Oto audio system
- **Format Support**: GIF (via asciicast2gif), MP4, WEBM

**Architecture Integration**:
- Leverages TUI framework from future Story 1.3
- Integrates with audio system from future Story 2.1
- Uses testing infrastructure from Story 0.1
- Prepares for PR automation in Story 0.3

**File Locations**:
- `pkg/recording/` - Recording system implementation
- `cmd/demo/` - Demo recording CLI tool
- `scripts/demo-scenarios/` - Pre-scripted demo scenarios
- `demos/` - Generated demo files and artifacts
- `pkg/input-viz/` - Input visualization overlay system

**Recording Requirements**:
- High-quality terminal capture with proper encoding
- Input overlay that clearly shows user interactions
- Audio synchronization for enhanced user experience
- Multiple format export for different use cases
- Automated scenario execution for consistent demos

### Tasks / Subtasks

1. **Implement Terminal Recording Core**:
   - [ ] Create `pkg/recording/terminal.go` for terminal session capture
   - [ ] Implement asciinema-compatible recording format
   - [ ] Add real-time terminal output capture
   - [ ] Support multiple terminal emulator compatibility
   - (AC: 1)

2. **Create Input Visualization System**:
   - [ ] Create `pkg/input-viz/overlay.go` for input overlays
   - [ ] Implement keyboard input visualization
   - [ ] Add mouse click/movement visualization
   - [ ] Create customizable overlay styles
   - (AC: 2)

3. **Implement Multi-Format Export**:
   - [ ] Add GIF export using asciicast2gif or similar
   - [ ] Implement MP4 export with ffmpeg integration
   - [ ] Add WEBM export for web optimization
   - [ ] Create format conversion utilities
   - (AC: 3)

4. **Build Demo Scenario System**:
   - [ ] Create `scripts/demo-scenarios/` structure
   - [ ] Implement scenario scripting language/format
   - [ ] Add automatic scenario execution
   - [ ] Create calculator-specific demo scenarios
   - (AC: 4)

5. **Integrate TUI Recording Capabilities**:
   - [ ] Capture TUI button interactions
   - [ ] Record keyboard shortcuts and navigation
   - [ ] Demonstrate mouse support in terminal
   - [ ] Show calculator operations visually
   - (AC: 5)

6. **Implement Audio Synchronization**:
   - [ ] Capture audio output during recording
   - [ ] Synchronize audio with visual interactions
   - [ ] Add audio track to video exports
   - [ ] Handle audio feedback timing
   - (AC: 6)

7. **Cross-Platform Recording Support**:
   - [ ] Test recording on Windows terminals
   - [ ] Validate macOS terminal recording
   - [ ] Ensure Linux compatibility across distributions
   - [ ] Handle platform-specific terminal behaviors
   - (AC: 7)

8. **Optimize for Web and GitHub**:
   - [ ] Create GitHub-optimized GIF sizes
   - [ ] Generate thumbnail images for videos
   - [ ] Add metadata for proper embedding
   - [ ] Optimize file sizes for fast loading
   - (AC: 8)

9. **Create Demo CLI Tool**:
   - [ ] Build `cmd/demo/main.go` for manual recording
   - [ ] Add command-line options for format selection
   - [ ] Implement scenario selection and execution
   - [ ] Create recording management utilities

### Risk Assessment

**Implementation Risks**:
- **Primary Risk**: Terminal recording complexity across different terminals
- **Mitigation**: Use established recording libraries with fallbacks
- **Verification**: Cross-platform recording validation

**Audio Synchronization Risk**:
- **Secondary Risk**: Audio/video synchronization accuracy
- **Mitigation**: Use timestamp-based synchronization with buffer management
- **Verification**: Test audio sync across different scenarios

**File Size Risk**:
- **Tertiary Risk**: Large demo files affecting GitHub storage/performance
- **Mitigation**: Implement compression and optimization strategies
- **Verification**: Monitor file sizes and optimize accordingly

### Rollback Plan

- Disable audio recording if synchronization fails
- Fall back to screenshot sequences if terminal recording fails
- Use basic asciinema format without overlays as minimum viable

### Safety Checks

- [ ] Recording system does not interfere with calculator functionality
- [ ] Demo generation runs independently of core application
- [ ] Recording can be disabled without affecting tests
- [ ] Audio capture respects system privacy settings

### Dependencies

- TUI framework integration (Story 1.3)
- Audio system (future Story 2.1)
- Visual testing infrastructure (Story 0.1)
- ffmpeg or equivalent for video processing

### Demo Scenarios to Implement

1. **Basic Calculator Operations**: Addition, subtraction, multiplication, division
2. **Advanced Features**: Memory functions, history navigation
3. **TUI Interactions**: Mouse clicks, keyboard navigation
4. **Audio Feedback**: Button sounds, operation confirmations
5. **Error Handling**: Invalid inputs, error messages
6. **Accessibility**: Screen reader compatibility, keyboard-only navigation

### Definition of Done

- [ ] All acceptance criteria met with working demonstrations
- [ ] Recording system captures complete user sessions
- [ ] Input visualization clearly shows user interactions
- [ ] Multiple export formats generate properly
- [ ] Demo scenarios execute automatically
- [ ] Audio synchronization works correctly
- [ ] Cross-platform compatibility verified
- [ ] Generated demos are GitHub-ready
- [ ] CLI tool enables manual demo creation
- [ ] Documentation includes recording system guide